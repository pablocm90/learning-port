<%= link_to learning_portfolio_path, class: "block hover:opacity-90 transition" do %>
  <svg class="w-full" viewBox="0 0 400 130" preserveAspectRatio="xMidYMin meet">
    <defs>
      <linearGradient id="mini-paint-gradient" x1="0%" y1="0%" x2="0%" y2="100%">
        <stop offset="0%" style="stop-color: var(--theme-primary); stop-opacity: 1;" />
        <stop offset="100%" style="stop-color: var(--theme-primary); stop-opacity: 0.9;" />
      </linearGradient>

      <!-- Organic edge filter -->
      <filter id="mini-organic-edge" x="-3%" y="-3%" width="106%" height="106%">
        <feTurbulence type="fractalNoise" baseFrequency="0.02" numOctaves="2" result="noise" seed="2"/>
        <feDisplacementMap in="SourceGraphic" in2="noise" scale="2" xChannelSelector="R" yChannelSelector="G"/>
      </filter>
    </defs>

    <g filter="url(#mini-organic-edge)">
      <!-- Brush stroke -->
      <path d="M -5,8
               Q 50,18 120,10
               Q 200,22 280,12
               Q 350,20 405,14
               L 405,32
               Q 350,30 280,35
               Q 200,32 120,36
               Q 50,33 -5,35
               Z"
            fill="url(#mini-paint-gradient)"/>

      <!-- Drips merging from brush stroke -->
      <% categories.each_with_index do |category, index| %>
        <%
          x_pos = ((index + 1) * (400.0 / (categories.count + 1))).to_i
          depth_percentage = max_depth > 0 ? (category.drip_depth / max_depth * 100) : 0
          min_drip = 45
          max_drip = 75
          drip_length = min_drip + (depth_percentage / 100.0 * (max_drip - min_drip))

          # Scaled dimensions
          merge_w = 22
          neck_w = 10
          mid_w = 13
          blob_w = 16

          y_merge = 22
          y_exit = 34
          y_neck = y_exit + 12
          y_mid = y_exit + drip_length * 0.45
          y_bulge = y_exit + drip_length * 0.7
          y_blob_top = y_exit + drip_length - 14
          y_end = y_exit + drip_length

          x_wobble = (index % 3 - 1) * 2
        %>

        <path d="M <%= x_pos - merge_w/2 + x_wobble %>,<%= y_merge %>
                 Q <%= x_pos - merge_w/2 - 2 + x_wobble %>,<%= y_exit %> <%= x_pos - neck_w/2 + x_wobble %>,<%= y_neck %>
                 Q <%= x_pos - mid_w/2 - 2 + x_wobble %>,<%= y_mid - 12 %> <%= x_pos - mid_w/2 + x_wobble %>,<%= y_mid %>
                 Q <%= x_pos - mid_w/2 + 1 + x_wobble %>,<%= y_bulge - 6 %> <%= x_pos - blob_w/2 + x_wobble %>,<%= y_bulge %>
                 Q <%= x_pos - blob_w/2 - 2 + x_wobble %>,<%= y_blob_top %> <%= x_pos - blob_w/2 + 2 + x_wobble %>,<%= y_blob_top + 5 %>
                 Q <%= x_pos - blob_w/3 + x_wobble %>,<%= y_end + 4 %> <%= x_pos + x_wobble %>,<%= y_end + 6 %>
                 Q <%= x_pos + blob_w/3 + x_wobble %>,<%= y_end + 4 %> <%= x_pos + blob_w/2 - 2 + x_wobble %>,<%= y_blob_top + 5 %>
                 Q <%= x_pos + blob_w/2 + 2 + x_wobble %>,<%= y_blob_top %> <%= x_pos + blob_w/2 + x_wobble %>,<%= y_bulge %>
                 Q <%= x_pos + mid_w/2 - 1 + x_wobble %>,<%= y_bulge - 6 %> <%= x_pos + mid_w/2 + x_wobble %>,<%= y_mid %>
                 Q <%= x_pos + mid_w/2 + 2 + x_wobble %>,<%= y_mid - 12 %> <%= x_pos + neck_w/2 + x_wobble %>,<%= y_neck %>
                 Q <%= x_pos + merge_w/2 + 2 + x_wobble %>,<%= y_exit %> <%= x_pos + merge_w/2 + x_wobble %>,<%= y_merge %>
                 Z"
              fill="url(#mini-paint-gradient)"/>
      <% end %>
    </g>

    <!-- Category names outside filter for crisp text -->
    <% categories.each_with_index do |category, index| %>
      <%
        x_pos = ((index + 1) * (400.0 / (categories.count + 1))).to_i
        depth_percentage = max_depth > 0 ? (category.drip_depth / max_depth * 100) : 0
        min_drip = 45
        max_drip = 75
        drip_length = min_drip + (depth_percentage / 100.0 * (max_drip - min_drip))
        y_end = 34 + drip_length
      %>
      <text x="<%= x_pos %>" y="<%= y_end + 18 %>"
            text-anchor="middle"
            class="fill-current text-muted"
            style="font-size: 9px; font-weight: 500;">
        <%= truncate(category.name, length: 12) %>
      </text>
    <% end %>
  </svg>
<% end %>
