<%= link_to learning_portfolio_path, class: "block hover:opacity-90 transition" do %>
  <svg class="w-full" viewBox="0 0 400 120" preserveAspectRatio="xMidYMin meet">
    <%
      drip_colors = ['#E85D75', '#F97316', '#FBBF24', '#22C55E', '#14B8A6', '#3B82F6', '#8B5CF6', '#EC4899', '#6366F1']
    %>

    <!-- Top paint band with color sections -->
    <% categories.each_with_index do |category, index| %>
      <%
        section_width = 400.0 / categories.count
        x_start = index * section_width
        color_idx = index % drip_colors.length
      %>
      <rect x="<%= x_start %>" y="8" width="<%= section_width + 1 %>" height="20"
            fill="<%= drip_colors[color_idx] %>"/>
    <% end %>

    <!-- Paint drips - multiple per category for overlap -->
    <%
      all_drips = []
      categories.each_with_index do |category, cat_idx|
        base_x = ((cat_idx + 1) * (400.0 / (categories.count + 1))).to_i
        depth_percentage = max_depth > 0 ? (category.drip_depth / max_depth * 100) : 0
        base_drip_length = 35 + (depth_percentage / 100.0 * 35)

        all_drips << { x: base_x, length: base_drip_length, width: 12, cat_idx: cat_idx }
        all_drips << { x: base_x - 10, length: base_drip_length * 0.65, width: 7, cat_idx: cat_idx }
        all_drips << { x: base_x + 9, length: base_drip_length * 0.8, width: 8, cat_idx: cat_idx }
      end
    %>

    <% all_drips.sort_by { |d| d[:x] }.each do |drip| %>
      <%
        x = drip[:x]
        drip_length = drip[:length]
        width = drip[:width]
        color = drip_colors[drip[:cat_idx] % drip_colors.length]

        y_start = 26
        y_end = y_start + drip_length
        bulb_r = width * 0.55
      %>
      <path d="M <%= x - width/2 %>,<%= y_start %>
               Q <%= x - width/2 %>,<%= y_end - bulb_r * 2 %>
                 <%= x - bulb_r %>,<%= y_end - bulb_r %>
               Q <%= x - bulb_r %>,<%= y_end %>
                 <%= x %>,<%= y_end + bulb_r * 0.3 %>
               Q <%= x + bulb_r %>,<%= y_end %>
                 <%= x + bulb_r %>,<%= y_end - bulb_r %>
               Q <%= x + width/2 %>,<%= y_end - bulb_r * 2 %>
                 <%= x + width/2 %>,<%= y_start %>
               Z"
            fill="<%= color %>"/>
    <% end %>

    <!-- Category names -->
    <% categories.each_with_index do |category, index| %>
      <%
        x_pos = ((index + 1) * (400.0 / (categories.count + 1))).to_i
        depth_percentage = max_depth > 0 ? (category.drip_depth / max_depth * 100) : 0
        drip_length = 35 + (depth_percentage / 100.0 * 35)
        y_end = 26 + drip_length
      %>
      <text x="<%= x_pos %>" y="<%= y_end + 16 %>"
            text-anchor="middle"
            class="fill-current text-muted"
            style="font-size: 9px; font-weight: 500;">
        <%= truncate(category.name, length: 12) %>
      </text>
    <% end %>
  </svg>
<% end %>
